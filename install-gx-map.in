#!/bin/sh

# $Id: install-gx-map.in,v 1.14 2003-08-29 17:10:17-07 kst Exp $
# $Source: /home/kst/gx-map-redacted/install-gx-map.in,v $

########################################################################
# @Copyright@
#
# Copyright (c) 2003 The Regents of the University of California. All
# rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are
# met:
#
# 1. Redistributions of source code must retain the above copyright
# notice, this list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above copyright
# notice, this list of conditions and the following disclaimer in the
# documentation and/or other materials provided with the distribution.
#
# 3. All advertising materials mentioning features or use of this
# software must display the following acknowledgement: This product
# includes software developed by the Grid and Cluster Computing Group
# at the San Diego Supercomputer Center and its contributors.
#
# 4. Neither the name of the Center nor the names of its contributors
# may be used to endorse or promote products derived from this software
# without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS''
# AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
# THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS
# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# @Copyright@
########################################################################

########################################################################
# Developed by Keith Thompson <kst@sdsc.edu>
########################################################################

verbosely () {
    echo "% $@"
    "$@"
    if [ $? -ne 0 ] ; then exit 1 ; fi
}

INSTALL_DIR=%INSTALL_DIR%
BINDIR=$INSTALL_DIR/bin
SBINDIR=$INSTALL_DIR/sbin
LIBDIR=$INSTALL_DIR/lib
DATA_DIR=%DATA_DIR%

BIN_FILES="gx-map"
SBIN_FILES="gx-check-requests gx-gen-mapfile"
LIB_FILES="Gridmap_Utils.pm Gridmap_Valid_Mappings.pm"
DATA_FILES="ncsa-sdsc-user-map"

for dir in $INSTALL_DIR \
           $BINDIR \
           $SBINDIR \
           $LIBDIR \
           $DATA_DIR \
           $DATA_DIR/RCS \
           $DATA_DIR/cache
do
    if [ ! -d $dir ] ; then
        verbosely mkdir -m 755 $dir
    fi
done

verbosely touch $DATA_DIR/requests.log
verbosely chmod 400 $DATA_DIR/requests.log

verbosely cp -f $BIN_FILES  $BINDIR/.
verbosely cp -f $SBIN_FILES $SBINDIR/.
verbosely cp -f $LIB_FILES  $LIBDIR/.
verbosely cp -f $DATA_FILES $DATA_DIR/.

if [ ! -d $DATA_DIR/new-requests ] ; then
    verbosely mkdir -m 1733 $DATA_DIR/new-requests
fi

if [ ! -f $DATA_DIR/new-requests/.update ] ; then
    verbosely touch $DATA_DIR/new-requests/.update 
    verbosely chmod 666 $DATA_DIR/new-requests/.update 
fi

if [ ! -h $INSTALL_DIR/var ] ; then
    verbosely ln -s $DATA_DIR $INSTALL_DIR/var
fi
