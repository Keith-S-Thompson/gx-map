#!/usr/bin/perl

# $Id: decorate,v 1.2 2007-10-09 16:49:59-07 kst Exp $
# $Source: /home/kst/gx-map-redacted/ca/Attic/decorate,v $

use strict;
use warnings;

my $igtf_version = '1.17';

my $hash = undef;
my $status = undef;

open my $PIPE, '|-', 'checksums';

while (<>) {
    print $PIPE $_;
    if (/^HASH\s+([\da-f]{8})\b/) {
        $hash = $1;
    }
    if (/^## status\s+=\s+(\w+)/) {
        $status = $1;
    }
}

print $PIPE '=' x 72, "\n";
# print "hash = $hash\n";
# print "status = $status\n";

my $command = "cert-info -ca $hash";
if (defined $status) {
    $command .= " .igtf-$igtf_version/igtf-policy-installation-bundle-$igtf_version/src/$status/$hash.0";
}

print $PIPE `$command`;

close $PIPE;
