#!/bin/sh

# $Id: make-release,v 1.18 2006-04-07 00:16:27-07 kst Exp $
# $Source: /home/kst/gx-map-redacted/make-release,v $

try() {
    echo "% $@"
    eval "$@" || exit 1
}

if [ $# -ne 1 ] ; then
    echo "Usage: $0 num" 1>&2
    exit 1
fi

case "$1" in
    -*)
        echo "Usage: $0 num" 1>&2
        exit 1
        ;;
esac

num=$1
in_files=`ls *.in | grep -v gx-map.conf.in`
other_files="INSTALL LICENSE Makefile README README.CA \
             README.CA-Security README.Cross-Site README.Prereqs \
             README.TeraGrid README.Upgrade Relnotes cleanup-gx-map \
             configure-gx-map gx-check-prereqs gx-map.odp gx-map.pdf \
             gx-map.ppt gx-propagate.in.teragrid gx-propagate.in.test \
             sample.conf test-gx-map"

# cadesc_files=`cd ca ; echo *.cadesc`
# bug_files=`cd bugs ; echo bug-*`

if [ -f release/gx-map-$num.tar.gz ] ; then
    echo "release/gx-map-$num.tar.gz already exists" 1>&2
    exit 1
fi

try mkdir release/gx-map-$num
try cd release/gx-map-$num

for file in $in_files ; do
    try cp -p ../../$file .
done
for file in $other_files ; do
    try cp -p ../../$file .
done

try mkdir ca
try cd ca
ls ../../../ca | grep '\.cadesc$' | \
    while read file ; do
        try cp -p ../../../ca/$file .
    done
try cd ..

try mkdir bugs
try cd bugs
ls ../../../bugs | grep '^bug-....$' | \
    while read file ; do
        try cp -p ../../../bugs/$file .
    done
try cd ..

try mkdir doc
try cd doc
ls ../../../doc | grep '\.pod$' | \
    while read file ; do
	try cp -p ../../../doc/$file .
    done
try cd ..

try cd ..
try tar zcf gx-map-$num.tar.gz gx-map-$num
try rm -rf gx-map-$num
