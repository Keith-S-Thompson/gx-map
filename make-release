#!/bin/sh

# $Id: make-release,v 1.12 2005-09-02 16:06:03-07 kst Exp $
# $Source: /home/kst/gx-map-redacted/make-release,v $

try() {
    echo "% $@"
    eval "$@" || exit 1
}

if [ $# -ne 1 ] ; then
    echo "Usage: $0 num" 1>&2
    exit 1
fi

num=$1
in_files=`ls *.in | grep -v gx-map.conf.in`
cadesc_files=`cd ca ; echo *.cadesc`
bug_files=`cd bugs ; echo bug-*`

try mkdir release/gx-map-$num
try cd release/gx-map-$num

for file in \
    $in_files \
    INSTALL \
    LICENSE \
    Makefile \
    README \
    README.CA \
    README.CA-Security \
    README.Cross-Site \
    README.Prereqs \
    README.TeraGrid \
    README.Upgrade \
    Relnotes \
    cleanup-gx-map \
    configure-gx-map \
    gx-check-prereqs \
    gx-map.pdf \
    gx-map.ppt \
    gx-propagate.in.teragrid \
    sample.conf \
    test-gx-map
do
    try cp -p ../../$file .
done

try mkdir ca
try cd ca
for file in $cadesc_files ; do
    try cp -p ../../../ca/$file .
done
try cd ..

try mkdir bugs
try cd bugs
for file in $bug_files ; do
    try cp -p ../../../bugs/$file .
done
try cd ..

try cd ..
try tar zcf gx-map-$num.tar.gz gx-map-$num

